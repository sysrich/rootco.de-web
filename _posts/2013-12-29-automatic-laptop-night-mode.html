---
layout: post
status: publish
published: true
title: Automatic GNOME 'Night Mode'
author:
  display_name: sysrich
  login: sysrich
  email: RBrownCCB@opensuse.org
  url: ''
author_login: sysrich
author_email: RBrownCCB@opensuse.org
wordpress_id: 248
wordpress_url: http://www.sysrich.co.uk/?p=248
date: '2013-12-29 16:00:21 +0100'
date_gmt: '2013-12-29 16:00:21 +0100'
categories:
- openSUSE
- GNOME
- Tech Tips
tags:
- featured
---
<p>While driving back from a family get-together over the Christmas holiday, I noticed how the Android Google Maps navigator automatically enabled a 'dark mode' between certain times, with the a darker colour palette with lots of grey and dark tones than the usual bright whites and vibrant colours.</p>
<p>That got me thinking, could I set up something similar to automatically turn on my laptop?</p>
<p>My desktop of choice (GNOME 3) already has an optional dark theme (used for certain Video and Picture applications). In GNOME tweak tool it's possible to enable a 'Global dark mode', which enables it for every application, but this is normally a manual process, I wanted something automatic.</p>
<p>[caption id="attachment_251" align="aligncenter" width="300"]<a href="https://sysrich.co.uk/wp-content/uploads/2013/12/Screenshot-from-2013-12-29-135111.png"><img class="size-medium wp-image-251 " alt="GNOME 3 'Files' - normal theme" src="https://sysrich.co.uk/wp-content/uploads/2013/12/Screenshot-from-2013-12-29-135111-300x189.png" width="300" height="189" /></a> GNOME 3 'Files' - normal theme[/caption]</p>
<p>[caption id="attachment_252" align="aligncenter" width="300"]<a href="https://sysrich.co.uk/wp-content/uploads/2013/12/Screenshot-from-2013-12-29-135303.png"><img class="size-medium wp-image-252 " alt="GNOME 3 'Files' with 'Global Dark Theme' enabled" src="https://sysrich.co.uk/wp-content/uploads/2013/12/Screenshot-from-2013-12-29-135303-300x189.png" width="300" height="189" /></a> GNOME 3 'Files' with 'Global Dark Theme' enabled[/caption]</p>
<p>So, I started by writing the following script to check the time and enable dark mode between 6PM and 6AM.</p>
<pre>#!/bin/sh
# GNOME 3 'Night Mode' enabler script
# License: GPLv3
# (c)Richard Brown rbrownccb@opensuse.org

H=$(date +%H)

if (( 6 &lt;= 10#$H &amp;&amp; 10#$H &lt; 18 )); then
    prefdark=0
 else
    prefdark=1
fi

sed -i "s/\(gtk-application-prefer-dark-theme *= *\).*/$prefdark/" ~/.config/gtk-3.0/settings.ini</pre>
<p>I called the script 'darkswitch.sh', made it executable and placed it in my ~/bin directory</p>
<p>At this point, I set it to run automatically on login by setting the script to run in gnome-session-properties (GNOME Tweak Tool can't add custom applications yet); However, I realised I still had 2 problems</p>
<ol>
<li>I needed to have a way of running the script at certain times so the theme would automatically kick in if I logged in during the 'day' but was still using the same session at 'night'</li>
<li>I needed to have a way of running the script when resuming my laptop from sleep, to make sure it applied the right theme for the time the laptop is waking up in.</li>
</ol>
<p>Issue #1 can easily be solved by cron, but Issue #2 needed a little more thought, until I realised that systemd could solve both, and also make sure the script gets run on every system startup.</p>
<p>First I created the following systemd unit file, which I called nightmode.timer and placed in /etc/systemd/system</p>
<pre>[Unit]
Description=Night Mode Timer

[Timer]
OnCalendar=06:00:00
OnCalendar=18:00:00

[Install]
WantedBy=nightmode.service</pre>
<p>Alongside it in the same folder, I also made a nightmode.service file as below <em>NOTE: If you're copying this, make sure you change the User= and ExecStart= fields to use the username and file location of your user account, not mine</em></p>
<pre>[Unit]
Description=Night Mode Service
Wants=nightmode.timer
After=suspend.target

[Service]
User=ilmehtar
ExecStart=/home/ilmehtar/bin/darkswitch.sh

[Install]
WantedBy=graphical.target
WantedBy=suspend.target</pre>
<p>I then enabled both the timer and the service with systemctl</p>
<pre>systemctl enable nightmode.service
systemctl enable nightmode.timer</pre>
<p>And with that, I was done, my laptop now automatically turns on the GNOME Dark Theme for all applications launched after 6PM and then returns to 'normal' launching applications in the default theme at 6AM</p>
<p>Let me know in the comments below if you find this interesting or can think of a better way of achieving the same (or better) results!</p>
